// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

enum Role {
  ADMIN
  USER
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  password  String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  projects  Project[] @relation("OwnerProjects")
}

model Client {
  id        String    @id @default(cuid())
  name      String
  email     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  projects  Project[]
  invoices  Invoice[]
}

model Project {
  id         String    @id @default(cuid())
  name       String
  status     String    @default("draft")
  clientId   String
  client     Client    @relation(fields: [clientId], references: [id])
  ownerId    String?
  owner      User?     @relation("OwnerProjects", fields: [ownerId], references: [id])
  invoices   Invoice[]
  expenses   Expense[]
  payments   Payment[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Invoice {
  id         String    @id @default(cuid())
  number     Int       @default(0)
  issueDate  DateTime  @default(now())
  dueDate    DateTime?
  status     String    @default("draft")
  amount     Decimal   @db.Decimal(12, 2)

  clientId   String
  client     Client    @relation(fields: [clientId], references: [id])

  projectId  String?
  project    Project?  @relation(fields: [projectId], references: [id])

  payments   Payment[]
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
}

model Payment {
  id         String    @id @default(cuid())
  amount     Decimal   @db.Decimal(12, 2)
  date       DateTime  @default(now())
  method     String?

  invoiceId  String?
  invoice    Invoice?  @relation(fields: [invoiceId], references: [id])

  projectId  String?
  project    Project?  @relation(fields: [projectId], references: [id])

  createdAt  DateTime  @default(now())
}

model Expense {
  id         String    @id @default(cuid())
  amount     Decimal   @db.Decimal(12, 2)
  date       DateTime  @default(now())
  category   String?
  note       String?

  projectId  String?
  project    Project?  @relation(fields: [projectId], references: [id])

  createdAt  DateTime  @default(now())
}
